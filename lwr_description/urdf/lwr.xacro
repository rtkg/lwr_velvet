<?xml version="1.0"?>
<robot name="lwr" xmlns:xacro="http://www.ros.org/wiki/xacro">

  <!-- Import all Gazebo-customization elements, including Gazebo colors -->
  <xacro:include filename="$(find lwr_description)/urdf/lwr.gazebo.xacro" />
  <!-- Import Transmissions -->
  <xacro:include filename="$(find lwr_description)/urdf/lwr.transmission.xacro" />
  <!-- Include Utilities -->
  <xacro:include filename="$(find lwr_description)/urdf/utilities.xacro" />
  <!-- Include Materials -->
  <xacro:include filename="$(find lwr_description)/urdf/materials.xacro"/>

  <!-- my constants
       <xacro:property name="joint_damping" value="0.5" />
       <xacro:property name="max_effort" value="300"/>
       <xacro:property name="max_velocity" value="10"/-->


  <!-- properties /-->
  <xacro:property name="base_mass" value="2.0"/>
  <xacro:property name="link_mass" value="2.0"/>
  <xacro:property name="velocity_scale" value="1"/>
  <xacro:property name="effort_scale" value="1"/>

  <!-- reflex to stiffness 
       <xacro:property name="max_stiffness" value="5000"/>
       <xacro:property name="min_stiffness" value="0"/>
       <xacro:property name="rate_stiffness" value="20000"/--> 

  <xacro:macro name="lwr" params="parent name hardware_interface *origin">

    <!--joint between {parent} and link_0-->
    <joint name="${parent}_joint" type="fixed">
      <insert_block name="origin"/>
      <parent link="${parent}"/>
      <child link="${name}_link_0"/>
    </joint>

    <link name="${name}_link_0">
      <inertial>
	<mass value="${base_mass}"/>
	<origin xyz="0 0 0.055"  />
	<cylinder_inertia_def radius="0.06" length="0.11" mass="${base_mass}"/>
      </inertial>
      <visual>
	<origin xyz="0 0 0" rpy="0 0 ${PI}"/>
	<geometry>
	  <mesh filename="package://lwr_description/meshes/base.STL"/>
	</geometry>
	<material name="LWR/Grey"/>
      </visual>
      <collision>
	<origin xyz="0 0 0.055" rpy="0 0 ${PI}"/>
	<geometry>
	  <!-- <mesh filename="package://lwr_description/meshes/convex/arm_base_convex.stl"/> -->
	  <cylinder radius="0.07" length="0.11"/>
	</geometry>
      </collision>
    </link>

    <!-- Second segment of the arm. Joint along z-axis -->
    <joint name="${name}_joint_1" type="revolute">
      <origin xyz="0 0 0.11" rpy="0 0 0"/>
      <axis xyz="0 0 1"/>
      <limit lower="${-170 * PI / 180}" upper="${170 * PI / 180}" effort="176" velocity="${velocity_scale * 110 * PI / 180}" />
      <dynamics friction="10.0" damping="1.0"/>
      <parent link="${name}_link_0"/>
      <child link="${name}_link_1"/>
    </joint>



    <link name="${name}_link_1">
      <inertial>
	<mass value="${link_mass}"/>
	<origin rpy="0 0 0" xyz="0 -0.06 0.130"/>
	<cuboid_inertia_def length="0.12" width="0.06" height="0.260" mass="${link_mass}"/>
      </inertial>
      <visual>
	<origin xyz="0 0 -0.008" rpy="0 0 ${PI}"/>
	<geometry>
	  <mesh filename="package://lwr_description/meshes/link_1.STL"/>
	</geometry>
	<material name="LWR/Orange"/>
      </visual>
      <collision>
	<origin xyz="0 0 0.0" rpy="0 0 0"/>
	<geometry>
	  <!--mesh filename="package://lwr_description/meshes/convex/arm_segment_a_convex.stl"/-->
	  <sphere radius="0.07"/>
	</geometry>
      </collision>
      <collision>
	<origin xyz="0 0.06 0.2" rpy="0 0 0"/>
	<geometry>
	  <sphere radius="0.07"/>
	</geometry>
      </collision>
      <collision>
	<origin xyz="0 0.03 0.1" rpy="-0.291 0 0"/>
	<geometry>
	  <cylinder radius="0.07" length="0.208"/>
	</geometry>
      </collision>
    </link>


    <!-- Third segment of the arm. Joint along y-axis -->
    <joint name="${name}_joint_2" type="revolute">
      <origin xyz="0 0 0.2005" rpy="0 0 0"/>
      <axis xyz="0 -1 0"/>
      <limit lower="${-120 * PI / 180}" upper="${120 * PI / 180}" effort="176" velocity="${velocity_scale * 110 * PI / 180}" />
      <dynamics friction="10.0" damping="1.0"/>
      <parent link="${name}_link_1"/>
      <child link="${name}_link_2"/>
    </joint>

    <link name="${name}_link_2">
      <inertial>
	<mass value="${link_mass}"/>
	<origin rpy="0 0 0" xyz="0 0.06 ${0.130 - 0.06}"/>
	<cuboid_inertia_def length="0.12" width="0.06" height="0.260" mass="${link_mass}"/>
      </inertial>

      <visual>
	<origin xyz="0 0 0.0" rpy="0 0 ${PI}"/>
	<geometry>
	  <mesh filename="package://lwr_description/meshes/link_2.STL"/>
	</geometry>
	<material name="LWR/Orange"/>
      </visual>
      <collision>
	<origin xyz="0 0 0.2" rpy="0 0 0"/>
	<geometry>
	  <!--mesh filename="package://lwr_description/meshes/convex/arm_segment_b_convex.stl"/-->
	  <sphere radius="0.07"/>
	</geometry>
      </collision>
      <collision>
	<origin xyz="0 -0.06 0.0" rpy="0 0 0"/>
	<geometry>
	  <sphere radius="0.07"/>
	</geometry>
      </collision>
      <collision>
	<origin xyz="0 -0.03 0.1" rpy="-0.291 0 0"/>
	<geometry>
	  <cylinder radius="0.07" length="0.208"/>
	</geometry>
      </collision>
    </link>


    <!-- Fourth element of the arm. z-axis -->
    <joint name="${name}_joint_3" type="revolute">
      <origin xyz="0 0 0.20" rpy="0 0 0"/>
      <axis xyz="0 0 1"/>
      <limit lower="${-170 * PI / 180}" upper="${170 * PI / 180}" effort="100" velocity="${velocity_scale * 128 * PI / 180}" />
      <dynamics friction="10.0" damping="1.0"/>
      <parent link="${name}_link_2"/>
      <child link="${name}_link_3"/>
    </joint>


    <link name="${name}_link_3">
      <inertial>
	<mass value="${link_mass}"/>
	<origin rpy="0 0 0" xyz="0 0.06 0.130"/>
	<cuboid_inertia_def length="0.12" width="0.06" height="0.260" mass="${link_mass}"/>
      </inertial>

      <visual>
	<origin xyz="0 0 -0.008" rpy="0 0 ${PI}"/>
	<geometry>
	  <mesh filename="package://lwr_description/meshes/link_3.STL"/>
	</geometry>
	<material name="LWR/Orange"/>
      </visual>
      <collision>
	<origin xyz="0 0 0.0" rpy="0 0 0"/>
	<geometry>
	  <!--mesh filename="package://lwr_description/meshes/convex/arm_segment_a_convex.stl"/-->
	  <sphere radius="0.07"/>
	</geometry>
      </collision>
      <collision>
	<origin xyz="0 -0.06 0.2" rpy="0 0 0"/>
	<geometry>
	  <sphere radius="0.07"/>
	</geometry>
      </collision>
      <collision>
	<origin xyz="0 -0.03 0.1" rpy="0.291 0 0"/>
	<geometry>
	  <cylinder radius="0.07" length="0.208"/>
	</geometry>
      </collision>
    </link>

    <!-- fifth element of the arm. x-axis -->
    <joint name="${name}_joint_4" type="revolute">
      <origin xyz="0 0 0.20" rpy="0 0 0"/>
      <axis xyz="0 1 0"/>
      <limit lower="${-120 * PI / 180}" upper="${120 * PI / 180}" effort="100" velocity="${velocity_scale * 128 * PI / 180}" />
      <dynamics friction="10.0" damping="1.0"/>
      <parent link="${name}_link_3"/>
      <child link="${name}_link_4"/>
    </joint>


    <link name="${name}_link_4">
      <inertial>
	<mass value="${link_mass}"/>
	<origin rpy="0 0 0" xyz="0 -0.06 ${0.130 - 0.06}"/>
	<cuboid_inertia_def length="0.12" width="0.06" height="0.2600" mass="${link_mass}"/>
      </inertial>

      <visual>
	<origin xyz="0 0 0.0" rpy="0 0 ${PI}"/>
	<geometry>
	  <mesh filename="package://lwr_description/meshes/link_4.STL"/>
	</geometry>
	<material name="LWR/Orange"/>
      </visual>
      <collision>
	<origin xyz="0 0 0.2" rpy="0 0 0"/>
	<geometry>
	  <!--mesh filename="package://lwr_description/meshes/convex/arm_segment_b_convex.stl"/-->
	  <sphere radius="0.07"/>
	</geometry>
      </collision>
      <collision>
	<origin xyz="0 0.06 0.0" rpy="0 0 0"/>
	<geometry>
	  <sphere radius="0.07"/>
	</geometry>
      </collision>
      <collision>
	<origin xyz="0 0.03 0.1" rpy="0.291 0 0"/>
	<geometry>
	  <cylinder radius="0.07" length="0.208"/>
	</geometry>
      </collision>
    </link>

    <!-- Sixth element of the arm. z-axis -->
    <joint name="${name}_joint_5" type="revolute">
      <origin xyz="0 0 0.20" rpy="0 0 0"/>
      <axis xyz="0 0 1"/>
      <limit lower="${-170 * PI / 180}" upper="${170 * PI / 180}" effort="100" velocity="${velocity_scale * 204 * PI / 180}" />
      <dynamics friction="10.0" damping="1.0"/>
      <parent link="${name}_link_4"/>
      <child link="${name}_link_5"/>
    </joint>


    <link name="${name}_link_5">
      <inertial>
	<mass value="${link_mass}"/>
	<origin rpy="0 0 0" xyz="0 0 0.124"/>
	<cuboid_inertia_def length="0.12" width="0.06" height="0.248" mass="${link_mass}"/>
      </inertial>

      <visual>
	<origin xyz="0 0 -0.008" rpy="0 0 ${PI}"/>
	<geometry name="${name}_5_geom">
	  <mesh filename="package://lwr_description/meshes/link_5.STL"/>
	</geometry>
	<material name="LWR/Orange"/>
      </visual>

      <collision>
	<origin xyz="0 0 0.0" rpy="0 0 0"/>
	<geometry>
	  <!--mesh filename="package://lwr_description/meshes/convex/arm_segment_last_convex.stl"/-->
	  <sphere radius="0.07"/>
	</geometry>
      </collision>
      <collision>
	<origin xyz="0 0.04 0.19" rpy="0 0 0"/>
	<geometry>
	  <sphere radius="0.07"/>
	</geometry>
      </collision>
      <collision>
	<origin xyz="0 0.02 0.095" rpy="-0.207 0 0"/>
	<geometry>
	  <cylinder radius="0.07" length="0.198"/>
	</geometry>
      </collision>
    </link>

    <!-- Seventh element of the arm. z-axis -->
    <joint name="${name}_joint_6" type="revolute">
      <origin xyz="0 0 0.19" rpy="0 0 0"/>
      <axis xyz="0 -1 0"/>
      <limit lower="${-120 * PI / 180}" upper="${120 * PI / 180}" effort="38" velocity="${velocity_scale * 184 * PI / 180}" />
      <dynamics friction="10.0" damping="1.0"/>
      <parent link="${name}_link_5"/>
      <child link="${name}_link_6"/>
    </joint>


    <link name="${name}_link_6">
      <inertial>
	<mass value="0.2"/>
	<origin rpy="0 0 0" xyz="0 0 0.0625"/>
	<cuboid_inertia_def length="0.125" width="0.125" height="0.125" mass="0.2"/>
      </inertial>

      <visual>
	<origin xyz="0 0 0" rpy="0 0 ${PI}"/>
	<geometry>
	  <mesh filename="package://lwr_description/meshes/link_6.STL"/>
	</geometry>
	<material name="LWR/Grey"/>
      </visual>
      <collision>
	<origin xyz="0 0 0" rpy="0 0 ${PI}"/>
	<geometry>
	  <mesh filename="package://lwr_description/meshes/convex/arm_wrist_convex.stl"/>
	</geometry>
      </collision>
    </link>

    <!-- Eighth element of the arm. z-axis -->
    <joint name="${name}_joint_7" type="revolute">
      <origin xyz="0 0 0.078" rpy="0 0 0"/>
      <axis xyz="0 0 1"/>
      <limit lower="${-170 * PI / 180}" upper="${170 * PI / 180}" effort="38" velocity="${velocity_scale * 184 * PI / 180}" />
      <dynamics friction="10.0" damping="1.0"/>
      <parent link="${name}_link_6"/>
      <child link="${name}_link_7"/>
    </joint>


    <link name="${name}_link_7">
      <inertial>
	<mass value="0.2"/>
	<origin xyz="0 0 0"/>
	<cuboid_inertia_def length="1" width="1" height="1" mass="0.2"/>
      </inertial>
      <visual>
	<origin xyz="0 0 0" rpy="0 0 ${PI}"/>
	<geometry>
	  <mesh filename="package://lwr_description/meshes/link_7.STL"/>
	</geometry>
	<material name="LWR/DarkGrey"/>
      </visual>

      <collision>
	<origin xyz="0 0 0" rpy="0 0 ${PI}"/>
	<geometry>
	  <cylinder radius="0.04" length="0.05"/>
	</geometry>
      </collision>
    </link>

    <!--Extensions -->
    <xacro:lwr_gazebo name="${name}" />
    <xacro:lwr_transmission name="${name}" hardware_interface="${hardware_interface}"/>

  </xacro:macro>

</robot>
